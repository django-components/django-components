(()=>{var I=s=>new DOMParser().parseFromString(s,"text/html").documentElement.textContent,H=Array.isArray,v=s=>typeof s=="function",z=s=>s!==null&&typeof s=="object",N=s=>(z(s)||v(s))&&v(s.then)&&v(s.catch);function G(s,c){try{return c?s.apply(null,c):s()}catch(i){O(i)}}function x(s,c){if(v(s)){let i=G(s,c);return i&&N(i)&&i.catch(l=>{O(l)}),[i]}if(H(s)){let i=[];for(let l=0;l<s.length;l++)i.push(x(s[l],c));return i}else console.warn(`[DjangoComponents] Invalid value type passed to callWithAsyncErrorHandling(): ${typeof s}`)}function O(s){console.error(s)}var R=s=>{let c=new MutationObserver(i=>{for(let l of i)l.type==="childList"&&l.addedNodes.forEach(d=>{d.nodeName==="SCRIPT"&&d.hasAttribute("data-djc")&&s(d)})});return c.observe(document,{childList:!0,subtree:!0}),c};var $=()=>{let s=new Set,c=new Set,i={},l={},d=new Map,g=[],E=!1,C=null,u=new Map,q=t=>{if(t.tag!=="link")throw Error(`[DjangoComponents] loadCss received tag '${t.tag}' but expected 'link'`);let n=document.createElement("link");for(let[e,o]of Object.entries(t.attrs))o===!0?n.setAttribute(e,""):o!==!1&&n.setAttribute(e,String(o));return n},K=t=>{if(t.tag!=="script")throw Error(`[DjangoComponents] loadJs received tag '${t.tag}' but expected 'script'`);let n=document.createElement("script");for(let[e,o]of Object.entries(t.attrs))o===!0?n.setAttribute(e,""):o!==!1&&n.setAttribute(e,String(o));return t.content&&(n.textContent=t.content),n},_=t=>{let n=typeof t=="string"?JSON.parse(t):t,e=K(n),o=n.attrs.src;if(!o||typeof o!="string"||w("js",o))return{el:e,promise:Promise.resolve()};T("js",o);let a=new Promise((p,m)=>{e.onload=()=>{p()},globalThis.document.body.append(e)});return{el:e,promise:a}},F=t=>{let n=typeof t=="string"?JSON.parse(t):t,e=q(n),o=n.attrs.href;if(!(!o||typeof o!="string"||w("css",o)))return globalThis.document.head.append(e),T("css",o),{el:e,promise:Promise.resolve()}},T=(t,n)=>{if(t!=="js"&&t!=="css")throw Error(`[DjangoComponents] markScriptLoaded received invalid script type '${t}'. Must be one of 'js', 'css'`);(t==="js"?s:c).add(n);let o=d.get(`${t}:${n}`);o&&o.resolve()},w=(t,n)=>{if(t!=="js"&&t!=="css")throw Error(`[DjangoComponents] isScriptLoaded received invalid script type '${t}'. Must be one of 'js', 'css'`);return(t==="js"?s:c).has(n)},L=async(t,n)=>{let e=n.map(o=>{if(w(t,o))return Promise.resolve();if(d.has(o))return d.get(o).promise;let a={};d.set(`${t}:${o}`,a);let p=new Promise(m=>{a.resolve=m});return a.promise=p,p});await Promise.all(e)},P=(t,n,e)=>`${t}:${n}:${e!=null?e:"null"}`,k=t=>{let n=i[t.compClsId];if(!n||n.length===0)return!0;if(t.jsVarsHash!=null){let e=`${t.compClsId}:${t.jsVarsHash}`;if(!l[e])return!0}if(t.waitForPromise){let e=P(t.compClsId,t.compId,t.jsVarsHash),o=u.get(e);if(o===void 0||o!==null)return!0}return!1},W=()=>{C==null&&(C=setInterval(()=>{let t=Date.now(),n=g.filter(e=>k(e));if(n.length>0){let e=n[0],o=Math.floor((t-e.queuedAt)/1e3);console.warn(`[DjangoComponents] ${n.length} component call(s) are still waiting for dependencies. Oldest call has been waiting for ${o}s: '${e.compClsId}' (ID: ${e.compId})`)}},5e3))},b=async()=>{if(!E){for(E=!0;g.length>0;){let t=g[0],n=P(t.compClsId,t.compId,t.jsVarsHash);if(t.waitForPromise!=null&&u.has(n)){let e=u.get(n);if(e!=null)throw g.length=0,u.clear(),E=!1,new Error(`[DjangoComponents] Script loading failed for component call '${t.compClsId}' (ID: ${t.compId}): ${e.message}`)}if(k(t))break;g.shift(),t.waitForPromise&&u.delete(n);try{let e=await V(t.compClsId,t.compId,t.jsVarsHash);t.resolve&&t.resolve(e)}catch(e){t.reject?t.reject(e):console.error(`[DjangoComponents] Error executing component call for '${t.compClsId}' (ID: ${t.compId}):`,e)}}!g.length&&C!=null&&(clearInterval(C),C=null),E=!1}},B=(t,n)=>{i[t]||(i[t]=[]),i[t].push(n),b()},J=(t,n,e)=>{let o=`${t}:${n}`;l[o]=e,b()},A=(t,n,e,o=void 0)=>{let a=P(t,n,e);o&&o.then(()=>{u.set(a,null),b()}).catch(m=>{u.set(a,m),b()});let p=new Promise((m,h)=>{g.push({compClsId:t,compId:n,jsVarsHash:e,queuedAt:Date.now(),waitForPromise:o,resolve:m,reject:h})});return g.length>0&&W(),p},V=async(t,n,e)=>{let o=i[t];if(!o||o.length===0)throw Error(`[DjangoComponents] '${t}': No component registered for that name`);let a=Array.from(document.querySelectorAll(`[data-djc-id-${n}]`));if(!a.length)throw Error(`[DjangoComponents] '${t}': No elements with component ID '${n}' found`);let p={};if(e!=null){let j=`${t}:${e}`,y=l[j];if(!y)throw Error(`[DjangoComponents] '${t}': Cannot find JS variables for hash '${e}'`);p=y()}let m={name:t,id:n,els:a},h;for(let j of o){let[y]=x(j,[p,m]);h=await y}return h},D=t=>{let n=t.cssUrls__markAsLoaded.map(r=>atob(r)),e=t.jsUrls__markAsLoaded.map(r=>atob(r)),o=t.cssTags__toFetch.map(r=>JSON.parse(atob(r))),a=t.jsTags__toFetch.map(r=>JSON.parse(atob(r))),p=t.componentJsVars.map(r=>r.map(atob)),m=t.componentJsCalls.map(([r,S,f])=>[atob(r),atob(S),f==null?f:atob(f)]);p.forEach(([r,S,f])=>{J(r,S,()=>JSON.parse(f))}),n.forEach(r=>T("css",r)),e.forEach(r=>T("js",r)),Promise.all(o.map(r=>F(r))).catch(console.error);let h=Promise.all(a.map(r=>_(r).promise)).catch(console.error),j=L("js",e),y=Promise.all([h,j]);for(let[r,S,f]of m)A(r,S,f,y);return b()},M=t=>{let n=JSON.parse(t.text);D(n)};return R(M),document.querySelectorAll("script[data-djc]").forEach(M),{callComponent:A,registerComponent:B,registerComponentData:J,loadJs:_,loadCss:F,markScriptLoaded:T,waitForScriptsToLoad:L,_loadComponentScripts:D}};var U={manager:$(),createComponentsManager:$,unescapeJs:I};globalThis.DjangoComponents=U;globalThis.Components===void 0&&(globalThis.Components=U);})();
